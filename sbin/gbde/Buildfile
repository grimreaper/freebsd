# $FreeBSD$

.PATH:	${BSDSRCTOP}/sys/geom/bde \
	${BSDSRCTOP}/sys/crypto/rijndael \
	${BSDSRCTOP}/sys/crypto/sha2

PROG = gbde

SRCS = \
	g_bde_lock.c \
	gbde.c \
	rijndael-alg-fst.c \
	rijndael-api-fst.c \
	sha2.c \
	template.c

# rijndael-fst.c does evil casting things which results in warnings on
# 64 bit machines, the test-vectors check out however, so it works right.
.if ${MACHINE_ARCH} == "i386"
WARNS ?= 5
.else
WARNS ?= 3
.endif

LDADD += -lmd -lutil -lgeom

template.c: template.txt
	file2c 'const char template[] = {' ',0};' \
		< ${.ALLSRC} > ${.TARGET}

test: ${PROG}
	sh ${.CURDIR}/test.sh ${.CURDIR}

SRCDIRDEP= sys/crypto/rijndael sys/crypto/sha2 sys/geom/bde
DIRDEP= gnu/lib/csu gnu/lib/libgcc include lib/csu/MACHINE_ARCH lib/libc lib/libgeom lib/libmd lib/libutil stage sys/MACHINE_ARCH/include sys/crypto/rijndael sys/crypto/sha2 sys/geom sys/geom/bde sys/sys
.include <bsd.prog.mk>
